
namespace Utility;
internal static class BitOps {
    //##########################################################################################################################################################
    //##########################################################################################################################################################
    //##########################################################################################################################################################
    //##########################################################################################################################################################
    [Impl(AggressiveInlining)] internal static u32 ExtractBit(u32 A, int i) => (A & (1u <<i));
    [Impl(AggressiveInlining)] internal static u64 ExtractBit(u64 A, int i) => (A & (1UL<<i));

    //==========================================================================================================================================================
    [Impl(AggressiveInlining)] internal static bool GetBit(u32 A, int i) => (A & (1u <<i)) != 0u;
    [Impl(AggressiveInlining)] internal static bool GetBit(u64 A, int i) => (A & (1UL<<i)) != 0UL;

    //==========================================================================================================================================================
    [Impl(AggressiveInlining)] internal static u32 SetBit(u32 A, int i, int SetTo) => (A & ~(1u <<i)) | ((SetTo == 0 ? 0u  : 1u )<<i);
    [Impl(AggressiveInlining)] internal static u64 SetBit(u64 A, int i, int SetTo) => (A & ~(1UL<<i)) | ((SetTo == 0 ? 0UL : 1UL)<<i);

    //==========================================================================================================================================================
    [Impl(AggressiveInlining)] internal static u32 ToggleBit(u32 A, int i) => A ^ (1u <<i);
    [Impl(AggressiveInlining)] internal static u64 ToggleBit(u64 A, int i) => A ^ (1UL<<i);

    //##########################################################################################################################################################
    //##########################################################################################################################################################
    [Impl(AggressiveInlining)] internal static int BitCount(u32 A) => System.Numerics.BitOperations.PopCount(A);
    [Impl(AggressiveInlining)] internal static int BitCount(u64 A) => System.Numerics.BitOperations.PopCount(A);

    //==========================================================================================================================================================
    //
    //  1100_1010  -->  0101_0011
    //
    internal static uint BitFlip(uint A) {
        A = ((A >> 1) & 0x_5555_5555) | ((A & 0x_5555_5555) << 1);
        A = ((A >> 2) & 0x_3333_3333) | ((A & 0x_3333_3333) << 2);
        A = ((A >> 4) & 0x_0F0F_0F0F) | ((A & 0x_0F0F_0F0F) << 4);
        A = ((A >> 8) & 0x_00FF_00FF) | ((A & 0x_00FF_00FF) << 8);

        return (A >> 16) | (A << 16);
    }

    //##########################################################################################################################################################
    //##########################################################################################################################################################
    //##########################################################################################################################################################
    //##########################################################################################################################################################
    //
    //  AB_CD_EF_12  -->  12_EF_CD_AB
    //
    [Impl(AggressiveInlining)] internal static uint  ByteFlip(uint  A) => ((A & 0xFF000000) >> 24)|((A & 0x00FF0000) >>  8)|((A & 0x0000FF00) <<  8)|((A & 0x000000FF) << 24);
    [Impl(AggressiveInlining)] internal static bvec4 ByteFlip(bvec4 A) => ((uint)A.x             )|((uint)A.y        <<  8)|((uint)A.z        << 16)|((uint)A.w        << 24);

    //##########################################################################################################################################################
    //##########################################################################################################################################################
    //##########################################################################################################################################################
    //##########################################################################################################################################################
    [Impl(AggressiveInlining)] internal static float BitDec(float A) => System.MathF.BitDecrement(A);
    [Impl(AggressiveInlining)] internal static float BitInc(float A) => System.MathF.BitIncrement(A);

    //##########################################################################################################################################################
    //##########################################################################################################################################################
    //##########################################################################################################################################################
    //##########################################################################################################################################################
}
